#!/usr/bin/env python3
"""Remove ALL common English words from ticker aliases to prevent false positives."""

import logging

from app.db.models import Ticker
from app.db.session import get_db

logger = logging.getLogger(__name__)

# Comprehensive list of common English words that should not be ticker aliases
COMMON_WORDS: set[str] = {
    # Single letters
    "a",
    "i",
    "o",
    # Two letter words
    "it",
    "go",
    "do",
    "so",
    "no",
    "up",
    "in",
    "on",
    "at",
    "to",
    "of",
    "is",
    "as",
    "be",
    "or",
    "we",
    "he",
    "me",
    "my",
    "us",
    "am",
    "an",
    "if",
    "by",
    "hi",
    "ok",
    "oh",
    "ah",
    "eh",
    "uh",
    "yo",
    "ax",
    "ex",
    "ox",
    "ad",
    "ed",
    "id",
    "od",
    "ag",
    "eg",
    "ig",
    "og",
    "ug",
    "ai",
    "oi",
    "aw",
    "ew",
    "ow",
    "ay",
    "ey",
    "oy",
    "ba",
    "da",
    "fa",
    "ga",
    "ha",
    "ja",
    "ka",
    "la",
    "ma",
    "na",
    "pa",
    "ra",
    "sa",
    "ta",
    "va",
    "wa",
    "ya",
    "za",
    "ab",
    "eb",
    "ib",
    "ob",
    "ub",
    "ac",
    "ec",
    "ic",
    "oc",
    "uc",
    "af",
    "ef",
    "uf",
    "ih",
    "aj",
    "ej",
    "ij",
    "oj",
    "uj",
    "ak",
    "ek",
    "ik",
    "uk",
    "al",
    "el",
    "il",
    "ol",
    "ul",
    "em",
    "im",
    "om",
    "um",
    "en",
    "un",
    "ap",
    "ep",
    "ip",
    "op",
    "ar",
    "er",
    "ir",
    "ur",
    "es",
    "os",
    "et",
    "ot",
    "ut",
    "av",
    "ev",
    "iv",
    "ov",
    "uv",
    "iw",
    "uw",
    "ix",
    "ux",
    "iy",
    "uy",
    "az",
    "ez",
    "iz",
    "oz",
    "uz",
    # Three letter words
    "the",
    "and",
    "for",
    "are",
    "but",
    "not",
    "you",
    "all",
    "can",
    "had",
    "her",
    "was",
    "one",
    "our",
    "out",
    "day",
    "get",
    "has",
    "him",
    "his",
    "how",
    "its",
    "may",
    "new",
    "now",
    "old",
    "see",
    "two",
    "way",
    "who",
    "boy",
    "did",
    "man",
    "men",
    "put",
    "say",
    "she",
    "too",
    "use",
    "war",
    "win",
    "won",
    "yes",
    "yet",
    "big",
    "buy",
    "car",
    "cut",
    "end",
    "far",
    "few",
    "got",
    "hit",
    "hot",
    "let",
    "lot",
    "low",
    "own",
    "run",
    "set",
    "sit",
    "sun",
    "top",
    "try",
    "why",
    "bad",
    "bag",
    "bed",
    "bit",
    "box",
    "bus",
    "cat",
    "cup",
    "dog",
    "ear",
    "eat",
    "egg",
    "eye",
    "fly",
    "fun",
    "gun",
    "hat",
    "job",
    "key",
    "kid",
    "leg",
    "lie",
    "log",
    "map",
    "mix",
    "net",
    "oil",
    "pay",
    "pen",
    "pie",
    "pig",
    "pot",
    "red",
    "row",
    "sea",
    "six",
    "sky",
    "son",
    "tax",
    "tea",
    "ten",
    "tie",
    "toy",
    "van",
    "web",
    "zip",
    "zoo",
    "act",
    "add",
    "age",
    "ago",
    "air",
    "any",
    "arm",
    "art",
    "ask",
    "bar",
    "bet",
    "dad",
    "don",
    "dry",
    "due",
    "fit",
    "off",  # Four letter words
    "this",
    "that",
    "with",
    "have",
    "will",
    "your",
    "from",
    "they",
    "know",
    "want",
    "been",
    "good",
    "much",
    "some",
    "time",
    "very",
    "when",
    "come",
    "here",
    "just",
    "like",
    "long",
    "make",
    "many",
    "over",
    "such",
    "take",
    "than",
    "them",
    "well",
    "were",
    "what",
    "year",
    "work",
    "back",
    "call",
    "came",
    "each",
    "even",
    "find",
    "give",
    "hand",
    "help",
    "keep",
    "kind",
    "last",
    "late",
    "left",
    "life",
    "line",
    "live",
    "look",
    "made",
    "move",
    "name",
    "need",
    "news",
    "next",
    "nice",
    "nine",
    "none",
    "nose",
    "note",
    "okay",
    "once",
    "only",
    "open",
    "oral",
    "page",
    "paid",
    "pair",
    "park",
    "part",
    "pass",
    "past",
    "path",
    "peak",
    "pick",
    "plan",
    "play",
    "plus",
    "poll",
    "poor",
    "port",
    "post",
    "pull",
    "push",
    "race",
    "rail",
    "rain",
    "rank",
    "rate",
    "read",
    "real",
    "rear",
    "rest",
    "rich",
    "ride",
    "ring",
    "rise",
    "risk",
    "road",
    "rock",
    "role",
    "roll",
    "room",
    "root",
    "rose",
    "rule",
    "rush",
    "safe",
    "said",
    "sake",
    "sale",
    "salt",
    "same",
    "sand",
    "save",
    "seat",
    "seed",
    "seek",
    "seem",
    "seen",
    "self",
    "sell",
    "send",
    "sent",
    "sets",
    "ship",
    "shop",
    "shot",
    "show",
    "shut",
    "sick",
    "side",
    "sign",
    "silk",
    "sing",
    "sink",
    "site",
    "size",
    "skin",
    "slip",
    "slow",
    "snap",
    "snow",
    "soft",
    "soil",
    "sold",
    "sole",
    "song",
    "soon",
    "sort",
    "soul",
    "soup",
    "sour",
    "span",
    "spin",
    "spot",
    "star",
    "stay",
    "step",
    "stop",
    "suit",
    "sure",
    "swim",
    "tail",
    "talk",
    "tall",
    "tank",
    "tape",
    "task",
    "team",
    "tear",
    "tell",
    "tend",
    "term",
    "test",
    "text",
    "then",
    "thin",
    "thus",
    "till",
    "tiny",
    "tire",
    "told",
    "toll",
    "tone",
    "took",
    "tool",
    "toss",
    "tour",
    "town",
    "tree",
    "trip",
    "true",
    "tube",
    "tune",
    "turn",
    "twin",
    "type",
    "unit",
    "upon",
    "used",
    "user",
    "uses",
    "vary",
    "vast",
    "view",
    "vote",
    "wait",
    "wake",
    "walk",
    "wall",
    "ward",
    "warm",
    "warn",
    "wash",
    "wave",
    "ways",
    "weak",
    "wear",
    "week",
    "went",
    "west",
    "whip",
    "wide",
    "wife",
    "wild",
    "wind",
    "wine",
    "wing",
    "wire",
    "wise",
    "wish",
    "wolf",
    "wood",
    "word",
    "wore",
    "worm",
    "worn",
    "wrap",
    "yard",
    "yell",
    "zone",
    # Five letter words
    "about",
    "above",
    "after",
    "again",
    "below",
    "could",
    "every",
    "first",
    "found",
    "great",
    "house",
    "large",
    "might",
    "never",
    "other",
    "place",
    "right",
    "small",
    "sound",
    "still",
    "their",
    "there",
    "these",
    "think",
    "three",
    "under",
    "water",
    "where",
    "which",
    "world",
    "would",
    "write",
    "years",
    "young",
    "being",
    "black",
    "bring",
    "build",
    "carry",
    "catch",
    "cause",
    "check",
    "child",
    "clear",
    "close",
    "color",
    "cover",
    "cross",
    "drive",
    "early",
    "earth",
    "eight",
    "field",
    "final",
    "force",
    "front",
    "given",
    "going",
    "green",
    "group",
    "happy",
    "heart",
    "heavy",
    "human",
    "issue",
    "light",
    "local",
    "major",
    "money",
    "music",
    "night",
    "north",
    "often",
    "order",
    "paper",
    "party",
    "peace",
    "point",
    "power",
    "press",
    "quick",
    "quite",
    "round",
    "serve",
    "shall",
    "short",
    "since",
    "sleep",
    "south",
    "space",
    "stand",
    "start",
    "state",
    "story",
    "study",
    "table",
    "thank",
    "thing",
    "those",
    "today",
    "total",
    "until",
    "value",
    "visit",
    "voice",
    "watch",
    "white",
    "whole",
    "whose",
    "woman",
    "wrong",
    "youth",
}

# Important tickers that should keep their common word aliases
IMPORTANT_TICKERS: set[str] = {
    "COST",
    "LOW",
    "V",
    "T",
    "GOOGL",
    "GOOG",
    "META",
    "FB",
    "AMZN",
    "TSLA",
    "NVDA",
    "MSFT",
    "AAPL",
}


def clean_all_aliases(dry_run: bool = True) -> None:
    """Remove ALL common English words from ticker aliases.

    Args:
        dry_run: If True, only show what would be changed without making changes
    """
    db = next(get_db())

    changes_made = 0
    tickers_affected = 0

    for ticker in db.query(Ticker).all():
        original_aliases = ticker.aliases.copy()
        cleaned_aliases = []

        for alias in ticker.aliases:
            # Keep the alias if:
            # 1. It's not a common English word, OR
            # 2. The ticker is important and should keep common word aliases
            if alias.lower() not in COMMON_WORDS or ticker.symbol in IMPORTANT_TICKERS:
                cleaned_aliases.append(alias)
            else:
                if dry_run:
                    print(
                        f"Would remove alias '{alias}' from {ticker.symbol} ({ticker.name})"
                    )
                changes_made += 1

        if len(cleaned_aliases) != len(original_aliases):
            tickers_affected += 1
            if not dry_run:
                ticker.aliases = cleaned_aliases
                db.commit()
                print(
                    f"Cleaned {ticker.symbol}: removed {len(original_aliases) - len(cleaned_aliases)} common word aliases"
                )

    if dry_run:
        print("\nDRY RUN SUMMARY:")
        print(f"  Would affect {tickers_affected} tickers")
        print(f"  Would remove {changes_made} common word aliases")
        print("\nTo apply changes, run with --apply flag")
    else:
        print("\nCLEANUP COMPLETE:")
        print(f"  Affected {tickers_affected} tickers")
        print(f"  Removed {changes_made} common word aliases")


if __name__ == "__main__":
    import argparse

    parser = argparse.ArgumentParser(
        description="Remove ALL common English words from ticker aliases"
    )
    parser.add_argument(
        "--apply", action="store_true", help="Apply changes (default is dry run)"
    )

    args = parser.parse_args()

    logging.basicConfig(level=logging.INFO)

    clean_all_aliases(dry_run=not args.apply)
